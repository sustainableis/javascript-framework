!function(a,b){a.module("sis",["ngResource"]),a.module("sis.api",["sis"]),a.module("sis.modules",["sis"]),a.module("sis.api").constant("url","http://api.sustainableis.com/"),a.module("sis.api").constant("version","v1"),a.module("sis.api").value("sisToken",{}),a.module("sis.api").factory("authInterceptor",["$q","sisToken",function(a,b){return{request:function(a){return a.headers=a.headers||{},a.data&&"object"==typeof a.data&&(a.data=$.param(a.data)),b.access_token&&(a.headers.Authorization="Bearer "+b.access_token),a},response:function(b){return 503===b.status,b||a.when(b)}}}]),a.module("sis.api").config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.interceptors.push("authInterceptor")}]),a.module("sis.modules").config(["$sceDelegateProvider","$compileProvider","sisModulesProvider",function(c,d,e){setTimeout(function(){c.resourceUrlWhitelist(["self",e.path+"**"])}),a.module("sis.modules")._directive=function(c,e){d.directive(c,function(c){var d=e(),f={restrict:"E",templateUrl:function(b,d){var e=a.element(b).prop("tagName").toLowerCase();return c.path+e+"/"+d.version+"/"+e+".min.html"},scope:{id:"@id",version:"@version"}};return b.extend(d,f)})}}])}(window.angular,window._),function(a){a.module("sis.api").factory("BuildingsService",["$resource","url","version",function(a,b,c){return a(b+c+"/buildings/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a,b){a.module("sis.modules").provider("dataStore",function(){this.cache={},this.GET=0,this.POST=1,this.PUT=2,this.DELETE=3,this.$get=["$injector","$log","OauthService","FacilitiesService","OrganizationsService","BuildingsService","FeedsService","OutputsService","UsersService","WeatherService",function(a,c){var d=this,e=function(a){var c={},d=a.split("/");return b.each(d,function(a){var b=a.split(":"),d=b[0],e=b[1];c[d]=e}),c},f=function(c,f,g,h){var i=e(f),j=i.service.charAt(0).toUpperCase()+i.service.slice(1)+"Service",k=a.get(j),l=b.omit(i,"service");switch(c){case d.GET:k.query(l,function(a){h(a)},function(a){h(null,a)});break;case d.POST:k.save(l,g,function(a){h(a)},function(a){h(null,a)});break;case d.PUT:if(!b.has(k,"update"))return h(null,j+"has not method update");k.update(l,g,function(a){h(a)},function(a){h(null,a)});break;case d.DELETE:k["delete"](l,function(a){h(a)},function(a){h(null,a)});break;default:h(null,"Invalid method",c,"for calling",f)}},g=function(a,e){return b.has(d.cache,a)?(c.debug("Returned",d.cache[a],"from cache","for topic",a),e(d.cache[a])):void f(d.GET,a,null,function(b,f){c.debug("Returned",b,"from API","for topic",a),d.cache[a]=b,e(b,f)})},h=function(a,b,e){f(d.POST,a,b,function(b,d){c.debug("Returned",b,"from API","for topic",a),e(b,d)})},i=function(a,b,e){f(d.PUT,a,b,function(b,d){c.debug("Returned",b,"from API","for topic",a),e(b,d)})},j=function(a,b){f(d.DELETE,a,function(d,e){c.debug("Returned",d,"from API","for topic",a),b(d,e)})};return{get:g,post:h,put:i,"delete":j}}]})}(window.angular,window._),function(){var a={},b=function(b,c){a.hasOwnProperty(b)||(a[b]=[]);var d=a[b].push(c)-1;return{remove:function(){delete a[b][d]}}},c=function(b,c){if(a.hasOwnProperty(b)){var d=c||{};a[b].forEach(function(a){a(d)})}},d=function(){a={}};window.events={subscribe:b,publish:c,purge:d,topics:a}}(),function(a){a.module("sis.api").factory("FacilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/facilities/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("FeedsService",["$resource","url","version",function(a,b,c){return a(b+c+"/feeds/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("FilesService",["$resource","url","version",function(a,b,c){return a(b+c+"/files/:id/:verb",{id:"@id",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c){a.module("sis.modules").provider("sisLayouts",function(){this.$get=["$q","$log","$timeout","sisModules","LayoutsService",function(a,d,e,f,g){var h=[],i=function(c){var d=a.defer(),e=g.query({id:c,controller:"modules"});return e.$promise.then(function(a){h=b.clone(a),d.resolve()}),d.promise},j=function(d){var e=a.defer(),g=c(".placeholder");return b.each(g,function(a){console.log("PLACEHOLDER",a);var c=b.find(h,{placeholder:a.id});console.log("MODULE",c),f.append({container:".placeholder",slug:c.slug,id:c.id,version:"0.0.1",transclude:!0,scope:d})}),e.resolve(),e.promise};return{fetch_modules:i,append_modules:j}}]})}(window.angular,window._,window.$),function(a){a.module("sis.api").factory("LayoutsService",["$resource","url","version",function(a,b,c){return a(b+c+"/layouts/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c,d){a.module("sis.modules").provider("sisModules",function(){this.path=null,this.$get=["$injector","$q","$log","$rootScope","$compile","$timeout","dataStore",function(e,f,g,h,i,j,k){var l=this,m=[],n=function(b){var d=a.element(".module"),e=[];c.each(d,function(b){var d=(a.element(b).parent(),a.element(b).data("id")),g=a.element(b).data("version"),j=a.element(b).prop("tagName").toLowerCase(),k=document.createElement("script"),n=document.createElement("link"),o={id:d,tag:j,version:g};if(!c.some(m,o)){m.push(o),k.src=l.path+j+"/"+g+"/"+j+".min.js",n.rel="stylesheet",n.href=l.path+j+"/"+g+"/"+j+".min.css";var p=f(function(a){k.onload=function(){i(b)(h),a()}});e.push(p),document.getElementsByTagName("head")[0].appendChild(k),document.getElementsByTagName("head")[0].appendChild(n)}}),console.log(m),f.all(e).then(function(){j(b)})},o=function(a){var d=[];c.each(m,function(a){var e=f(function(d,e){k.get("service:modules/id:"+a.id+"/controller:channels",function(f,h){return h?e():(g.debug("Framework sent",f,"on",a.id+":channels"),b.publish(a.id+":channels",f),c.each(f,function(c){k.get(c.topic,function(d,e){g.debug("Framework sent",d,"on",a.id+":"+c.route),b.publish(a.id+":"+c.route,{data:d,error:e})})}),void d())})});d.push(e)}),f.all(d).then(function(){a()}),b.subscribe("get",function(a){g.debug("Framework got",a,"on","get"),k.get(a.topic,function(c,d){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("post",function(a){g.debug("Framework got",a,"on","post"),k.post(a.topic,a.payload,function(c,d){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("put",function(a){g.debug("Framework got",a,"on","post"),k.put(a.topic,a.payload,function(c,d){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("delete",function(a){g.debug("Framework got",a,"on","post"),k["delete"](a.topic,function(c,d){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})})},p=function(){c.each(m,function(b){var d=l.path+b.tag+"/"+b.version+"/"+b.tag+".min.js",e=l.path+b.tag+"/"+b.version+"/"+b.tag+".min.css",f=a.element("head").find("script"),g=a.element("head").find("link");c.each(f,function(b){b.src===d&&a.element(b).remove()}),c.each(g,function(b){b.href===e&&a.element(b).remove()})}),b.purge(),m=[]},q=function(a){var b=f.defer(),c=a.container,e=a.id,g=a.slug,h=a.version,j=a.transclude,k=a.scope,l=d(d(c)[0]),m=i("<"+g+' data-id="'+e+'" data-version="'+h+'" class="module">',j)(k);return l.append(m),b.resolve(),b.promise};return{discover:n,init:o,destroy:p,append:q,path:this.path}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ModulesService",["$resource","url","version",function(a,b,c){return a(b+c+"/modules/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("OauthService",["$resource","url",function(a,b){return a(b+"oauth/:controller",{controller:"@controller"})}])}(window.angular),function(a){a.module("sis.api").factory("OrganizationsService",["$resource","url","version",function(a,b,c){return a(b+c+"/organizations/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("OutputsService",["$resource","url","version",function(a,b,c){return a(b+c+"/outputs/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("RatesService",["$resource","url","version",function(a,b,c){return a(b+c+"/rates/:controller/:id/:verb/:second_id/:action",{controller:"@controller",id:"@id",verb:"@verb",second_id:"@second_id",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("UsersService",["$resource","url","version",function(a,b,c){return a(b+c+"/users/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("UtilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/utilities/:controller/:id/:verb/:verb_id",{controller:"@controller",id:"@id",verb:"@verb",verb_id:"@verb_id"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c,d){a.module("sis.modules").provider("sisViews",function(){this.$get=["$injector","$q","$log","$compile","$rootScope","FacilitiesService","LayoutsService","ViewsService","sisModules",function(b,e,f,g,h,i,j,k,l){var m=function(b,e){i.query({id:b.id,controller:"views",slug:b.slug},function(b){f.debug(b);var i=b[0];j.get({id:i.layout_id},function(b){f.debug(b),h.tpl=l.path+b.slug+"/"+b.slug+".html",h.$on("$includeContentLoaded",function(){var b=d(".placeholder");k.query({id:i.id,controller:"modules"},function(d){f.debug(d),c.each(b,function(b){var e=c.findWhere(d,{placeholder:b.id});if(e){var f="<"+e.slug+' class="module" data-id="'+e.id+'">';module_element=g(f)(h),a.element(b).append(module_element)}}),e()})})})})};return{load:m}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ViewsService",["$resource","url","version",function(a,b,c){return a(b+c+"/views/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("WeatherService",["$resource","url","version",function(a,b,c){return a(b+c+"/weather/:controller/:id/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular);