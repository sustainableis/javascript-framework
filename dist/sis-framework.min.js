!function(a,b){a.module("sis",["ngResource","oc.lazyLoad"]),a.module("sis.api",["sis"]),a.module("sis.modules",["sis"]),a.module("sis.api").value("sisToken",{}),a.module("sis.api").constant("url","http://api.sustainableis.com/"),a.module("sis.api").constant("version","v1"),a.module("sis.api").factory("authInterceptor",["$q","sisToken","sisApi",function(a,b,c){return{request:function(a){return a.headers=a.headers||{},a.data&&"object"==typeof a.data&&(a.data=$.param(a.data)),b.access_token&&a.url.indexOf(c.url)>-1&&(a.headers.Authorization="Bearer "+b.access_token),a},response:function(b){return 503===b.status,b||a.when(b)}}}]),a.module("sis.api").config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.interceptors.push("authInterceptor")}]),a.module("sis.modules").config(["$sceDelegateProvider","$compileProvider","$ocLazyLoadProvider","sisModulesProvider",function(c,d,e,f){setTimeout(function(){c.resourceUrlWhitelist(["self",f.path+"/**"])}),e.config({debug:!0,events:!0}),a.module("sis.modules")._directive=function(c,e){d.directive(c,["$injector","$ocLazyLoad",function(c,d){var g=e(c,d),h={restrict:"E",templateUrl:function(b,c){var d=a.element(b).prop("tagName").toLowerCase();return f.path+"/dist/"+d+"/"+c.version+"/"+d+".min.html"},scope:{id:"@id",version:"@version"}};return b.extend(h,g)}])}}])}(window.angular,window._),function(a){a.module("sis.api").provider("sisApi",function(){this.url="http://api.sustainableis.com/",this.version="v1",this.$get=function(){return{url:this.url,version:this.version}}})}(window.angular),function(a){a.module("sis.api").factory("AreasService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/areas/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("BatchService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/batch",{},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("BuildingsService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/buildings/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("ConfigurationsService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/configurations/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a,b){a.module("sis.modules").provider("dataStore",function(){this.cache={},this.expires=300,this.$get=["$injector","$log","OauthService","FacilitiesService","OrganizationsService","BuildingsService","FeedsService","OutputsService","UsersService","WeatherService",function(a,c){var d=this,e=0,f=1,g=2,h=3,i=function(a){var c={},d=a.split("/");return b.each(d,function(a){var b=a.split(":"),d=b[0],e=b[1];"@service"===d&&(c.is__object=!0,d="service"),c[d]=e}),c},j=function(d,j,k,l){var m=i(j),n=m.service.charAt(0).toUpperCase()+m.service.slice(1)+"Service",o=a.get(n),p=b.omit(m,["service","is__object"]);switch(d){case e:b.has(m,"is__object")?o.get(p,function(a){l(a)},function(a){c.error(a),l(null,a)}):o.query(p,function(a){l(a)},function(a){c.error(a),l(null,a)});break;case f:o.save(p,k,function(a){l(a)},function(a){c.error(a),l(null,a)});break;case g:if(!b.has(o,"update"))return l(null,n+"has not method update");o.update(p,k,function(a){l(a)},function(a){c.error(a),l(null,a)});break;case h:o["delete"](p,function(a){l(a)},function(a){c.error(a),l(null,a)});break;default:l(null,"Invalid method",d,"for calling",j)}},k=function(a,f,g){if(g=!1,b.has(d.cache,a)&&g===!0){if(moment().diff(d.cache[a].added,"seconds")<d.expires)return c.debug("Returned",d.cache[a].data,"from cache","for topic",a),f(d.cache[a].data);c.debug("Hit missed to cache for topic",a)}j(e,a,null,function(b,e){c.debug("Returned",b,"from API","for topic",a),d.cache[a]={data:b,added:moment()},f(b,e)})},l=function(a,b,d){j(f,a,b,function(b,e){c.debug("Returned",b,"from API","for topic",a),d(b,e)})},m=function(a,b,d){j(g,a,b,function(b,e){c.debug("Returned",b,"from API","for topic",a),d(b,e)})},n=function(a,b){j(h,a,function(d,e){c.debug("Returned",d,"from API","for topic",a),b(d,e)})};return{get:k,post:l,put:m,"delete":n}}]})}(window.angular,window._),function(){var a={},b=function(b,c){a.hasOwnProperty(b)||(a[b]=[]);var d=a[b].push(c)-1;return{remove:function(){delete a[b][d]}}},c=function(b,c){if(a.hasOwnProperty(b)){var d=c||{};a[b].forEach(function(a){a(d)})}},d=function(){a={}};window.events={subscribe:b,publish:c,purge:d,topics:a}}(),function(a){a.module("sis.api").factory("FacilitiesService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/facilities/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("FeedsService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/feeds/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("FieldsService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/fields/:id/:controller/:metric_name/:verb",{id:"@id",controller:"@controller",metric_name:"@metric_name",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("FilesService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/files/:id/:verb",{id:"@id",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c){a.module("sis.modules").provider("sisLayouts",function(){this.$get=["$q","$log","$timeout","sisModules","LayoutsService",function(a,d,e,f,g){var h=[],i=function(c){var d=a.defer(),e=g.query({id:c,controller:"modules"});return e.$promise.then(function(a){h=b.clone(a),d.resolve()}),d.promise},j=function(d){var e=a.defer(),g=c(".placeholder");return b.each(g,function(a){console.log("PLACEHOLDER",a);var c=b.find(h,{placeholder:a.id});console.log("MODULE",c),f.append({container:"#"+a.id,slug:c.slug,id:c.id,version:c.version,transclude:!0,scope:d})}),e.resolve(),e.promise};return{fetch_modules:i,append_modules:j}}]})}(window.angular,window._,window.$),function(a){a.module("sis.api").factory("LayoutsService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/layouts/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c){a.module("sis.modules").provider("sisModules",function(){this.path=null,this.$get=["$injector","$q","$log","$rootScope","$compile","$timeout","$ocLazyLoad","dataStore",function(d,e,f,g,h,i,j,k){var l=this,m=!1,n=function(){m||(m=!0,b.subscribe("get",function(a){f.debug("Framework got",a,"on","get"),k.get(a.topic,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})},a.cache)}),b.subscribe("post",function(a){f.debug("Framework got",a,"on","post"),k.post(a.topic,a.payload,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("put",function(a){f.debug("Framework got",a,"on","post"),k.put(a.topic,a.payload,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("delete",function(a){f.debug("Framework got",a,"on","post"),k["delete"](a.topic,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}))},o=function(a){k.get("service:modules/id:"+a+"/controller:channels",function(d,e){e||c.each(d,function(c){k.get(c.topic,function(d,e){f.debug("Framework sent",d,"on",a+":"+c.route),b.publish(a+":"+c.route,{data:d,error:e})})})})},p=function(b,d){var i=[],k=[],m=d||{},p=m.scope||g;i=a.element(c.has(m,"container")?m.container+" .module":".module"),n(),c.each(i,function(b){var c=a.element(b).data("id"),d=a.element(b).data("version"),e=a.element(b).prop("tagName").toLowerCase(),i=l.path+"/dist/"+e+"/"+d+"/"+e+".min",m=j.load({serie:!0,files:[i+".html",i+".js",i+".css"]}).then(function(){o(c)},function(){f.error("Module",e,":",c,"@",d,"is missing files")});k.push(m),g.$on("ocLazyLoad.fileLoaded",function(a,c){c===i+".js"&&h(b)(p)})}),e.all(k).then(b)},q=function(){};return{init:p,destroy:q,path:this.path}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ModulesService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/modules/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("OauthService",["$resource","sisApi",function(a,b){return a(b.url+"oauth/:controller",{controller:"@controller"})}])}(window.angular),function(a){a.module("sis.api").factory("OrganizationsService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/organizations/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("OutputsService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/outputs/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("RatesService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/rates/:controller/:id/:verb/:second_id/:action",{controller:"@controller",id:"@id",verb:"@verb",second_id:"@second_id",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("UsersService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/users/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("UtilitiesService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/utilities/:controller/:id/:verb/:verb_id",{controller:"@controller",id:"@id",verb:"@verb",verb_id:"@verb_id"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c,d){a.module("sis.modules").provider("sisViews",function(){this.$get=["$log","$compile","$ocLazyLoad","$q","$rootScope","dataStore","sisModules",function(b,e,f,g,h,i,j){var k=function(k,l){var m=a.element(".__view__"),n=[],o=l||{},p=o.scope||h;c.each(m,function(k){var l=a.element(k).data("id"),m=a.element(k).data("version"),o=a.element(k).prop("tagName").toLowerCase(),q=j.path+"/dist/"+o+"/"+m+"/"+o+".min",r=g.defer();f.load({serie:!0,files:[q+".html",q+".js",q+".css"]}).then(function(){i.get("service:views/id:"+l+"/controller:modules",function(b){var f=d(o+" .placeholder");c.each(f,function(d){var f=c.findWhere(b,{placeholder:d.id});if(f){var g="<"+f.slug+' class="module" data-id="'+f.id+'" data-version="'+f.version+'">';module_element=e(g)(p),a.element(d).empty(),a.element(d).append(module_element)}}),r.resolve()})},function(){b.error("Module",o,":",l,"@",m,"is missing files")}),h.$on("ocLazyLoad.fileLoaded",function(a,b){b===q+".js"&&e(k)(p)}),n.push(r.promise)}),g.all(n).then(k)};return{init:k}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ViewsService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/views/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("WeatherService",["$resource","sisApi",function(a,b){return a(b.url+b.version+"/weather/:controller/:id/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular);