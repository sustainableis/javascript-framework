"use strict";!function(a){a.module("sis",["ngResource","sis.api","sis.modules"]),a.module("sis.api",[]),a.module("sis.modules",[]),a.module("sis.api").constant("url","http://api.sustainableis.com/"),a.module("sis.api").constant("version","v1"),a.module("sis.modules").constant("path","http://d10t57k8pf74ki.cloudfront.net/"),a.module("sis.api").provider("sisConfiguration",function(){this.token=null,this.debug=!1,this.$get=["$injector",function(){return{token:this.token,debug:this.debug}}]}),a.module("sis.api").factory("authInterceptor",["$q","sisConfiguration",function(a,b){return{request:function(a){return a.headers=a.headers||{},a.data&&"object"==typeof a.data&&(a.data=$.param(a.data)),b.token&&(a.headers.Authorization="Bearer "+b.token),a},response:function(b){return 503===b.status,b||a.when(b)}}}]),a.module("sis.api").config(["$httpProvider","$logProvider","sisConfigurationProvider",function(a,b,c){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.interceptors.push("authInterceptor"),setTimeout(function(){b.debugEnabled(c.debug||!1)})}]),a.module("sis.modules").config(["$sceDelegateProvider","$compileProvider","path",function(b,c,d){b.resourceUrlWhitelist(["self",d+"**"]),a.module("sis.modules").compileProvider=c}])}(window.angular),function(a){a.module("sis.api").factory("BuildingsService",["$resource","url","version",function(a,b,c){return a(b+c+"/buildings/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a,b){a.module("sis.modules").provider("dataStore",function(){this.cache={},this.GET=0,this.POST=1,this.$get=["$injector","$log","OauthService","FacilitiesService","OrganizationsService","BuildingsService","FeedsService","OutputsService","UsersService","WeatherService",function(a,c){var d=this,e=function(a){var c={},d=a.split("/");return b.each(d,function(a){var b=a.split(":"),d=b[0],e=b[1];c[d]=e}),c},f=function(f,g,h,i){var g=e(g),j=g.service.charAt(0).toUpperCase()+g.service.slice(1)+"Service",k=a.get(j),l=b.omit(g,"service");switch(f){case d.GET:k.query(l,function(a){i(a)},function(a){i(null,a)});break;case d.POST:k.save(l,h,function(a){i(a)},function(a){i(null,a)});break;default:c.error("Invalid method",f,"for calling",g)}},g=function(a,e){return b.has(d.cache,a)?(c.debug("Returned",d.cache[a],"from cache","for topic",a),e(d.cache[a])):void f(d.GET,a,null,function(b,f){c.debug("Returned",b,"from API","for topic",a),d.cache[a]=b,e(b,f)})},h=function(a,b,e){f(d.POST,a,b,function(b,d){c.debug("Returned",b,"from API","for topic",a),e(b,d)})};return{get:g,post:h}}]})}(window.angular,window._),function(){var a={},b=function(b,c){a[b]||(a[b]={queue:[]}),a[b].queue.push(c)},c=function(b){delete a[topic].queue[b]},d=function(b,c){var c=c||{};a[b]&&a[b].queue.length&&a[b].queue.forEach(function(a){a(c)})},e=function(){a={}};window.events={subscribe:b,unsubscribe:c,publish:d,purge:e,topics:a}}(),function(a){a.module("sis.api").factory("FacilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/facilities/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"})}])}(window.angular),function(a){a.module("sis.api").factory("FeedsService",["$resource","url","version",function(a,b,c){return a(b+c+"/feeds/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("FilesService",["$resource","url","version",function(a,b,c){return a(b+c+"/files/:id/:verb",{id:"@id",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("LayoutsService",["$resource","url","version",function(a,b,c){return a(b+c+"/layouts/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a,b,c){a.module("sis.modules").provider("sisModules",function(){this.modules=[],this.$get=["$injector","$q","$log","$rootScope","$compile","dataStore","path",function(d,e,f,g,h,i,j){var k=this,l=function(){var b=a.element(".module"),d=[];c.each(b,function(b){var c=a.element(b).data("id"),f=a.element(b).parent(),i=a.element(b).prop("tagName").toLowerCase(),l=document.createElement("script");k.modules.push({id:c,tag:i}),a.element(b).remove(),l.src=j+i+"/"+i+".js";var m=e(function(a){l.onload=function(){var c=h(b)(g);f.append(c),a()}});d.push(m),document.getElementsByTagName("head")[0].appendChild(l)}),e.all(d).then(function(){callback()})},m=function(a){var d=[];c.each(k.modules,function(a){var g=e(function(d,e){i.get("service:modules/id:"+a.id+"/controller:channels",function(g,h){return h?e():(f.debug("Framework sent",g,"on",a.id+":channels"),b.publish(a.id+":channels",g),c.each(g,function(c){i.get(c.topic,function(d,e){f.debug("Framework sent",d,"on",a.id+":"+c.route),b.publish(a.id+":"+c.route,{data:d,error:e})})}),void d())})});d.push(g)}),b.subscribe("get",function(a){f.debug("Framework got",a,"on","get"),i.get(a.topic,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("post",function(a){f.debug("Framework got",a,"on","post"),i.post(a.topic,a.payload,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),e.all(d).then(function(){a()})},n=function(){c.each(k.modules,function(b){var d=j+b.tag+"/"+b.tag+".js",e=a.element("head").find("script");c.each(e,function(b){b.src===d&&a.element(b).remove()})}),b.purge(),k.modules=[]};return{discover:l,init:m,destroy:n}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ModulesService",["$resource","url","version",function(a,b,c){return a(b+c+"/modules/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"})}])}(window.angular),function(a){a.module("sis.api").factory("OauthService",["$resource","url",function(a,b){return a(b+"oauth/:controller",{controller:"@controller"})}])}(window.angular),function(a){a.module("sis.api").factory("OrganizationsService",["$resource","url","version",function(a,b,c){return a(b+c+"/organizations/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("OutputsService",["$resource","url","version",function(a,b,c){return a(b+c+"/outputs/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("UsersService",["$resource","url","version",function(a,b,c){return a(b+c+"/users/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("UtilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/utilities/:controller/:id/:verb/:verb_id",{controller:"@controller",id:"@id",verb:"@verb",verb_id:"@verb_id"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c,d){a.module("sis.modules").provider("sisViews",function(){this.$get=["$injector","$q","$log","$compile","$rootScope","FacilitiesService","LayoutsService","ViewsService","path",function(b,e,f,g,h,i,j,k,l){var m=function(b,e){i.query({id:b.id,controller:"views",slug:b.slug},function(b){f.debug(b);var i=b[0];j.get({id:i.layout_id},function(b){f.debug(b),h.tpl=l+b.slug+"/"+b.slug+".html",h.$on("$includeContentLoaded",function(){var b=d(".placeholder");k.query({id:i.id,controller:"modules"},function(d){f.debug(d),c.each(b,function(b){var e=c.findWhere(d,{placeholder:b.id});if(e){var f="<"+e.slug+' class="module" data-id="'+e.id+'">';module_element=g(f)(h),a.element(b).append(module_element)}}),e()})})})})};return{load:m}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ViewsService",["$resource","url","version",function(a,b,c){return a(b+c+"/views/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"})}])}(window.angular),function(a){a.module("sis.api").factory("WeatherService",["$resource","url","version",function(a,b,c){return a(b+c+"/weather/:controller/:id/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular);