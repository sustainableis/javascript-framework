"use strict";!function(a){a.module("sis",["ngResource","sis.api","sis.modules"]),a.module("sis.api",[]),a.module("sis.modules",[]),a.module("sis.api").constant("url","http://api.sustainableis.com/"),a.module("sis.api").constant("version","v1"),a.module("sis.modules").constant("path","http://d10t57k8pf74ki.cloudfront.net/**"),a.module("sis.api").provider("sisConfiguration",function(){this.token=null,this.debug=!1,this.$get=["$injector",function(){return{token:this.token,debug:this.debug}}]}),a.module("sis.api").factory("authInterceptor",["$q","sisConfiguration",function(a,b){return{request:function(a){return a.headers=a.headers||{},a.data&&"object"==typeof a.data&&(a.data=$.param(a.data)),b.token&&(a.headers.Authorization="Bearer "+b.token),a},response:function(b){return 503===b.status,b||a.when(b)}}}]),a.module("sis.api").config(["$httpProvider","$logProvider","sisConfigurationProvider",function(a,b,c){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.interceptors.push("authInterceptor"),setTimeout(function(){b.debugEnabled(c.debug||!1)})}]),a.module("sis.modules").config(["$sceDelegateProvider","path",function(a,b){a.resourceUrlWhitelist(["self",b])}])}(window.angular),function(a){a.module("sis.api").factory("BuildingsService",["$resource","url","version",function(a,b,c){return a(b+c+"/buildings/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a,b){a.module("sis.modules").provider("dataStore",function(){this.cache={},this.$get=["$injector","$log","OauthService","FacilitiesService","OrganizationsService","BuildingsService","FeedsService","OutputsService","UsersService","WeatherService",function(a,c){var d=this,e=function(a){var c={},d=a.split("/");return b.each(d,function(a){var b=a.split(":"),d=b[0],e=b[1];c[d]=e}),c},f=function(d,f,g,h){var f=e(f),i=f.service.charAt(0).toUpperCase()+f.service.slice(1)+"Service",j=a.get(i),k=b.omit(f,"service");switch(d){case"get":j.query(k,function(a){h(a)});break;case"post":j.save(k,g,function(a){h(a)});break;default:c.error("Invalid method",d,"for calling",f)}},g=function(a,e){return b.has(d.cache,a)?(c.debug("Returned",d.cache[a],"from cache","for topic",a),e(d.cache[a])):void f(a,function(b){c.debug("Returned",b,"from API","for topic",a),d.cache[a]=b,e(b)})},h=function(a,b,d){f("post",a,b,function(b){c.debug("Returned",b,"from API","for topic",a),d(b)})};return{get:g,post:h}}]})}(window.angular,window._),function(){var a={},b=function(b,c){a[b]||(a[b]={queue:[]}),a[b].queue.push(c)},c=function(b){delete a[topic].queue[b]},d=function(b,c){var c=c||{};a[b]&&a[b].queue.length&&a[b].queue.forEach(function(a){a(c)})};window.events={subscribe:b,unsubscribe:c,publish:d,topics:a}}(),function(a){a.module("sis.api").factory("FacilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/facilities/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"})}])}(window.angular),function(a){a.module("sis.api").factory("FeedsService",["$resource","url","version",function(a,b,c){return a(b+c+"/feeds/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("FilesService",["$resource","url","version",function(a,b,c){return a(b+c+"/files/:id/:verb",{id:"@id",verb:"@verb"})}])}(window.angular),function(a,b,c,d){a.module("sis.modules").provider("sisModules",function(){this.modules=[],this.$get=["$injector","$q","$log","dataStore","ModulesService",function(e,f,g,h,i){var j=this,k=function(){var b=d(".module");c.each(b,function(b){var c=a.element(b).data("id");j.modules.push({id:c})})},l=function(a){var d=[];c.each(j.modules,function(a){var e=i.query({id:a.id,controller:"channels"},function(d){g.debug("Framework sent",d,"on",a.id+":channels"),b.publish(a.id+":channels",d),c.each(d,function(c){h.get(c.topic,function(d){g.debug("Framework sent",d,"on",a.id+":"+c.route),b.publish(a.id+":"+c.route,d)})})});d.push(e)}),f.all(d).then(function(){a(),b.subscribe("get",function(a){g.debug("Framework got",a,"on","get"),h.get(a.channel,function(c){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,c)})}),b.subscribe("post",function(a){g.debug("Framework got",a,"on","post"),h.post(a.topic,a.payload,function(c){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,c)})})})};return{discover:k,init:l}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ModulesService",["$resource","url","version",function(a,b,c){return a(b+c+"/modules/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"})}])}(window.angular),function(a){a.module("sis.api").factory("OauthService",["$resource","url",function(a,b){return a(b+"oauth/:controller",{controller:"@controller"})}])}(window.angular),function(a){a.module("sis.api").factory("OrganizationsService",["$resource","url","version",function(a,b,c){return a(b+c+"/organizations/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("OutputsService",["$resource","url","version",function(a,b,c){return a(b+c+"/outputs/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("UsersService",["$resource","url","version",function(a,b,c){return a(b+c+"/users/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("UtilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/utilities/:controller/:id/:verb/:verb_id",{controller:"@controller",id:"@id",verb:"@verb",verb_id:"@verb_id"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("ViewsService",["$resource","url","version",function(a,b,c){return a(b+c+"/views/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"})}])}(window.angular),function(a){a.module("sis.api").factory("WeatherService",["$resource","url","version",function(a,b,c){return a(b+c+"/weather/:controller/:id/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular);