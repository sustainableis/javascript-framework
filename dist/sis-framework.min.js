"use strict";!function(a,b){a.module("sis",["ngResource"]),a.module("sis.api",["sis"]),a.module("sis.modules",["sis"]),a.module("sis.api").constant("url","http://api.sustainableis.com/"),a.module("sis.api").constant("version","v1"),a.module("sis.api").value("auth",{token:null}),a.module("sis.api").factory("authInterceptor",["$q","auth",function(a,b){return{request:function(a){return a.headers=a.headers||{},a.data&&"object"==typeof a.data&&(a.data=$.param(a.data)),b.token&&(a.headers.Authorization="Bearer "+b.token),a},response:function(b){return 503===b.status,b||a.when(b)}}}]),a.module("sis.api").config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.interceptors.push("authInterceptor")}]),a.module("sis.modules").config(["$sceDelegateProvider","$compileProvider","sisModulesProvider",function(c,d,e){setTimeout(function(){c.resourceUrlWhitelist(["self",e.path+"**"])}),a.module("sis.modules")._directive=function(c,e){d.directive(c,function(c){var d=e(),f={restrict:"E",templateUrl:function(b,d){var e=a.element(b).prop("tagName").toLowerCase();return c.path+e+"-"+d.version+".html"},scope:{id:"@id",version:"@version"}};return b.extend(d,f)})}}])}(window.angular,window._),function(a){a.module("sis.api").factory("BuildingsService",["$resource","url","version",function(a,b,c){return a(b+c+"/buildings/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a,b){a.module("sis.modules").provider("dataStore",function(){this.cache={},this.GET=0,this.POST=1,this.PUT=2,this.DELETE=3,this.$get=["$injector","$log","OauthService","FacilitiesService","OrganizationsService","BuildingsService","FeedsService","OutputsService","UsersService","WeatherService",function(a,c){var d=this,e=function(a){var c={},d=a.split("/");return b.each(d,function(a){var b=a.split(":"),d=b[0],e=b[1];c[d]=e}),c},f=function(c,f,g,h){var f=e(f),i=f.service.charAt(0).toUpperCase()+f.service.slice(1)+"Service",j=a.get(i),k=b.omit(f,"service");switch(c){case d.GET:j.query(k,function(a){h(a)},function(a){h(null,a)});break;case d.POST:j.save(k,g,function(a){h(a)},function(a){h(null,a)});break;case d.PUT:if(!b.has(j,"update"))return h(null,i+"has not method update");j.update(k,g,function(a){h(a)},function(a){h(null,a)});break;case d.DELETE:j["delete"](k,function(a){h(a)},function(a){h(null,a)});break;default:h(null,"Invalid method",c,"for calling",f)}},g=function(a,e){return b.has(d.cache,a)?(c.debug("Returned",d.cache[a],"from cache","for topic",a),e(d.cache[a])):void f(d.GET,a,null,function(b,f){c.debug("Returned",b,"from API","for topic",a),d.cache[a]=b,e(b,f)})},h=function(a,b,e){f(d.POST,a,b,function(b,d){c.debug("Returned",b,"from API","for topic",a),e(b,d)})},i=function(a,b,e){f(d.PUT,a,b,function(b,d){c.debug("Returned",b,"from API","for topic",a),e(b,d)})},j=function(a,b){f(d.DELETE,a,function(d,e){c.debug("Returned",d,"from API","for topic",a),b(d,e)})};return{get:g,post:h,put:i,"delete":j}}]})}(window.angular,window._),function(){var a={},b=function(b,c){a[b]||(a[b]={queue:[]}),a[b].queue.push(c)},c=function(b){delete a[topic].queue[b]},d=function(b,c){var c=c||{};a[b]&&a[b].queue.length&&a[b].queue.forEach(function(a){a(c)})},e=function(){a={}};window.events={subscribe:b,unsubscribe:c,publish:d,purge:e,topics:a}}(),function(a){a.module("sis.api").factory("FacilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/facilities/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"})}])}(window.angular),function(a){a.module("sis.api").factory("FeedsService",["$resource","url","version",function(a,b,c){return a(b+c+"/feeds/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("FilesService",["$resource","url","version",function(a,b,c){return a(b+c+"/files/:id/:verb",{id:"@id",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("LayoutsService",["$resource","url","version",function(a,b,c){return a(b+c+"/layouts/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a,b,c){a.module("sis.modules").provider("sisModules",function(){this.path=null,this.$get=["$injector","$q","$log","$rootScope","$compile","dataStore",function(d,e,f,g,h,i){var j=this,k=[],l=function(b){var d=a.element(".module"),f=[];c.each(d,function(b){var c=a.element(b).parent(),d=a.element(b).data("id"),i=a.element(b).data("version"),l=a.element(b).prop("tagName").toLowerCase(),m=document.createElement("script"),n=document.createElement("link");k.push({id:d,tag:l,version:i}),a.element(b).remove(),m.src=j.path+l+"-"+i+".js",n.rel="stylesheet",n.href=j.path+l+"-"+i+".css";var o=e(function(a){m.onload=function(){var d=h(b)(g);c.append(d),a()}});f.push(o),document.getElementsByTagName("head")[0].appendChild(m),document.getElementsByTagName("head")[0].appendChild(n)}),e.all(f).then(function(){b()})},m=function(a){var d=[];c.each(k,function(a){var g=e(function(d,e){i.get("service:modules/id:"+a.id+"/controller:channels",function(g,h){return h?e():(f.debug("Framework sent",g,"on",a.id+":channels"),b.publish(a.id+":channels",g),c.each(g,function(c){i.get(c.topic,function(d,e){f.debug("Framework sent",d,"on",a.id+":"+c.route),b.publish(a.id+":"+c.route,{data:d,error:e})})}),void d())})});d.push(g)}),b.subscribe("get",function(a){f.debug("Framework got",a,"on","get"),i.get(a.topic,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("post",function(a){f.debug("Framework got",a,"on","post"),i.post(a.topic,a.payload,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("put",function(a){f.debug("Framework got",a,"on","post"),i.put(a.topic,a.payload,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("delete",function(a){f.debug("Framework got",a,"on","post"),i["delete"](a.topic,function(c,d){f.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),e.all(d).then(function(){a()})},n=function(){c.each(k,function(b){var d=j.path+b.tag+"-"+b.version+".js",e=j.path+b.tag+"-"+b.version+".css",f=a.element("head").find("script"),g=a.element("head").find("link");c.each(f,function(b){b.src===d&&a.element(b).remove()}),c.each(g,function(b){b.href===e&&a.element(b).remove()})}),b.purge(),k=[]};return{discover:l,init:m,destroy:n,path:this.path}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ModulesService",["$resource","url","version",function(a,b,c){return a(b+c+"/modules/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"})}])}(window.angular),function(a){a.module("sis.api").factory("OauthService",["$resource","url",function(a,b){return a(b+"oauth/:controller",{controller:"@controller"})}])}(window.angular),function(a){a.module("sis.api").factory("OrganizationsService",["$resource","url","version",function(a,b,c){return a(b+c+"/organizations/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("OutputsService",["$resource","url","version",function(a,b,c){return a(b+c+"/outputs/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular),function(a){a.module("sis.api").factory("UsersService",["$resource","url","version",function(a,b,c){return a(b+c+"/users/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("UtilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/utilities/:controller/:id/:verb/:verb_id",{controller:"@controller",id:"@id",verb:"@verb",verb_id:"@verb_id"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c,d){a.module("sis.modules").provider("sisViews",function(){this.$get=["$injector","$q","$log","$compile","$rootScope","FacilitiesService","LayoutsService","ViewsService","sisModules",function(b,e,f,g,h,i,j,k,l){var m=function(b,e){i.query({id:b.id,controller:"views",slug:b.slug},function(b){f.debug(b);var i=b[0];j.get({id:i.layout_id},function(b){f.debug(b),h.tpl=l.path+b.slug+"/"+b.slug+".html",h.$on("$includeContentLoaded",function(){var b=d(".placeholder");k.query({id:i.id,controller:"modules"},function(d){f.debug(d),c.each(b,function(b){var e=c.findWhere(d,{placeholder:b.id});if(e){var f="<"+e.slug+' class="module" data-id="'+e.id+'">';module_element=g(f)(h),a.element(b).append(module_element)}}),e()})})})})};return{load:m}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ViewsService",["$resource","url","version",function(a,b,c){return a(b+c+"/views/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"})}])}(window.angular),function(a){a.module("sis.api").factory("WeatherService",["$resource","url","version",function(a,b,c){return a(b+c+"/weather/:controller/:id/:verb",{id:"@id",controller:"@controller",verb:"@verb"})}])}(window.angular);