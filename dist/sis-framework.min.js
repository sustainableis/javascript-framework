!function(a,b){a.module("sis",["ngResource","oc.lazyLoad"]),a.module("sis.api",["sis"]),a.module("sis.modules",["sis"]),a.module("sis.api").constant("url","http://api.sustainableis.com/"),a.module("sis.api").constant("version","v1"),a.module("sis.api").value("sisToken",{}),a.module("sis.api").factory("authInterceptor",["$q","sisToken",function(a,b){return{request:function(a){return a.headers=a.headers||{},a.data&&"object"==typeof a.data&&(a.data=$.param(a.data)),b.access_token&&(a.headers.Authorization="Bearer "+b.access_token),a},response:function(b){return 503===b.status,b||a.when(b)}}}]),a.module("sis.api").config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.defaults.headers.put["Content-Type"]="application/x-www-form-urlencoded; charset=UTF-8;",a.interceptors.push("authInterceptor")}]),a.module("sis.modules").config(["$sceDelegateProvider","$compileProvider","$ocLazyLoadProvider","sisModulesProvider",function(c,d,e,f){setTimeout(function(){c.resourceUrlWhitelist(["self",f.path+"/**"])}),e.config({debug:!0,events:!0}),a.module("sis.modules")._directive=function(c,e){d.directive(c,["$injector","$ocLazyLoad",function(c,d){var g=e(c,d),h={restrict:"E",templateUrl:function(b,c){var d=a.element(b).prop("tagName").toLowerCase();return f.path+"/dist/"+d+"/"+c.version+"/"+d+".min.html"},scope:{id:"@id",version:"@version"}};return b.extend(g,h)}])}}])}(window.angular,window._),function(a){a.module("sis.api").factory("BuildingsService",["$resource","url","version",function(a,b,c){return a(b+c+"/buildings/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a,b){a.module("sis.modules").provider("dataStore",function(){this.cache={},this.$get=["$injector","$log","OauthService","FacilitiesService","OrganizationsService","BuildingsService","FeedsService","OutputsService","UsersService","WeatherService",function(a,c){var d=this,e=0,f=1,g=2,h=3,i=function(a){var c={},d=a.split("/");return b.each(d,function(a){var b=a.split(":"),d=b[0],e=b[1];"@service"===d&&(c.is__object=!0,d="service"),c[d]=e}),c},j=function(d,j,k,l){var m=i(j),n=m.service.charAt(0).toUpperCase()+m.service.slice(1)+"Service",o=a.get(n),p=b.omit(m,["service","is__object"]);switch(d){case e:b.has(m,"is__object")?o.get(p,function(a){l(a)},function(a){c.error(a),l(null,a)}):o.query(p,function(a){l(a)},function(a){c.error(a),l(null,a)});break;case f:o.save(p,k,function(a){l(a)},function(a){c.error(a),l(null,a)});break;case g:if(!b.has(o,"update"))return l(null,n+"has not method update");o.update(p,k,function(a){l(a)},function(a){c.error(a),l(null,a)});break;case h:o["delete"](p,function(a){l(a)},function(a){c.error(a),l(null,a)});break;default:l(null,"Invalid method",d,"for calling",j)}},k=function(a,f){return b.has(d.cache,a)?(c.debug("Returned",d.cache[a],"from cache","for topic",a),f(d.cache[a])):void j(e,a,null,function(b,e){c.debug("Returned",b,"from API","for topic",a),d.cache[a]=b,f(b,e)})},l=function(a,b,d){j(f,a,b,function(b,e){c.debug("Returned",b,"from API","for topic",a),d(b,e)})},m=function(a,b,d){j(g,a,b,function(b,e){c.debug("Returned",b,"from API","for topic",a),d(b,e)})},n=function(a,b){j(h,a,function(d,e){c.debug("Returned",d,"from API","for topic",a),b(d,e)})};return{get:k,post:l,put:m,"delete":n}}]})}(window.angular,window._),function(){var a={},b=function(b,c){a.hasOwnProperty(b)||(a[b]=[]);var d=a[b].push(c)-1;return{remove:function(){delete a[b][d]}}},c=function(b,c){if(a.hasOwnProperty(b)){var d=c||{};a[b].forEach(function(a){a(d)})}},d=function(){a={}};window.events={subscribe:b,publish:c,purge:d,topics:a}}(),function(a){a.module("sis.api").factory("FacilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/facilities/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("FeedsService",["$resource","url","version",function(a,b,c){return a(b+c+"/feeds/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("FilesService",["$resource","url","version",function(a,b,c){return a(b+c+"/files/:id/:verb",{id:"@id",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c){a.module("sis.modules").provider("sisLayouts",function(){this.$get=["$q","$log","$timeout","sisModules","LayoutsService",function(a,d,e,f,g){var h=[],i=function(c){var d=a.defer(),e=g.query({id:c,controller:"modules"});return e.$promise.then(function(a){h=b.clone(a),d.resolve()}),d.promise},j=function(d){var e=a.defer(),g=c(".placeholder");return b.each(g,function(a){console.log("PLACEHOLDER",a);var c=b.find(h,{placeholder:a.id});console.log("MODULE",c),f.append({container:".placeholder",slug:c.slug,id:c.id,version:"0.0.1",transclude:!0,scope:d})}),e.resolve(),e.promise};return{fetch_modules:i,append_modules:j}}]})}(window.angular,window._,window.$),function(a){a.module("sis.api").factory("LayoutsService",["$resource","url","version",function(a,b,c){return a(b+c+"/layouts/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c,d){a.module("sis.modules").provider("sisModules",function(){this.path=null,this.$get=["$injector","$q","$log","$rootScope","$compile","$timeout","$ocLazyLoad","dataStore",function(e,f,g,h,i,j,k,l){var m=this,n=function(){b.subscribe("get",function(a){g.debug("Framework got",a,"on","get"),l.get(a.topic,function(c,d){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("post",function(a){g.debug("Framework got",a,"on","post"),l.post(a.topic,a.payload,function(c,d){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("put",function(a){g.debug("Framework got",a,"on","post"),l.put(a.topic,a.payload,function(c,d){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})}),b.subscribe("delete",function(a){g.debug("Framework got",a,"on","post"),l["delete"](a.topic,function(c,d){g.debug("Framework sent",c,"on",a.caller),b.publish(a.caller,{data:c,error:d})})})},o=function(a){l.get("service:modules/id:"+a+"/controller:channels",function(d,e){e||c.each(d,function(c){l.get(c.topic,function(d,e){g.debug("Framework sent",d,"on",a+":"+c.route),b.publish(a+":"+c.route,{data:d,error:e})})})})},p=function(b){var d=a.element(".module"),e=[];n(),c.each(d,function(b){var c=a.element(b).data("id"),d=a.element(b).data("version"),f=a.element(b).prop("tagName").toLowerCase(),g=m.path+"/dist/"+f+"/"+d+"/"+f+".min",j=k.load({serie:!0,files:[g+".html",g+".js",g+".css"]}).then(function(){o(c)});e.push(j),h.$on("ocLazyLoad.fileLoaded",function(a,c){c===g+".js"&&i(b)(h)})}),f.all(e).then(b)},q=function(){b.purge()},r=function(a){var b=f.defer(),c=a.container,e=a.id,g=a.slug,h=a.version,j=a.transclude,k=a.scope,l=d(d(c)[0]),m=i("<"+g+' data-id="'+e+'" data-version="'+h+'" class="module">',j)(k);return l.append(m),b.resolve(),b.promise};return{init:p,destroy:q,append:r,path:this.path}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ModulesService",["$resource","url","version",function(a,b,c){return a(b+c+"/modules/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("OauthService",["$resource","url",function(a,b){return a(b+"oauth/:controller",{controller:"@controller"})}])}(window.angular),function(a){a.module("sis.api").factory("OrganizationsService",["$resource","url","version",function(a,b,c){return a(b+c+"/organizations/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("OutputsService",["$resource","url","version",function(a,b,c){return a(b+c+"/outputs/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("RatesService",["$resource","url","version",function(a,b,c){return a(b+c+"/rates/:controller/:id/:verb/:second_id/:action",{controller:"@controller",id:"@id",verb:"@verb",second_id:"@second_id",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("UsersService",["$resource","url","version",function(a,b,c){return a(b+c+"/users/:id/:controller/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("UtilitiesService",["$resource","url","version",function(a,b,c){return a(b+c+"/utilities/:controller/:id/:verb/:verb_id",{controller:"@controller",id:"@id",verb:"@verb",verb_id:"@verb_id"},{update:{method:"PUT"}})}])}(window.angular),function(a,b,c,d){a.module("sis.modules").provider("sisViews",function(){this.$get=["$log","$compile","$rootScope","dataStore","sisModules",function(b,e,f,g,h){var i=function(b,i){g.get("service:facilities/id:"+b.id+"/controller:views/slug:"+b.slug,function(b){var j=b[0];g.get("@service:layouts/id:"+j.layout_id,function(b){f.tpl=h.path+"/dist/"+b.slug+"/"+b.version+"/"+b.slug+".min.html",f.$on("$includeContentLoaded",function(){g.get("service:views/id:"+j.id+"/controller:modules",function(b){var g=d(".placeholder");c.each(g,function(d){var g=c.findWhere(b,{placeholder:d.id});if(g){var h="<"+g.slug+' class="module" data-id="'+g.id+'" data-version="'+g.version+'">';module_element=e(h)(f),a.element(d).empty(),a.element(d).append(module_element)}}),i()})})})})};return{load:i}}]})}(window.angular,window.events,window._,window.$),function(a){a.module("sis.api").factory("ViewsService",["$resource","url","version",function(a,b,c){return a(b+c+"/views/:id/:controller/:verb/:action",{id:"@id",controller:"@controller",verb:"@verb",action:"@action"},{update:{method:"PUT"}})}])}(window.angular),function(a){a.module("sis.api").factory("WeatherService",["$resource","url","version",function(a,b,c){return a(b+c+"/weather/:controller/:id/:verb",{id:"@id",controller:"@controller",verb:"@verb"},{update:{method:"PUT"}})}])}(window.angular);